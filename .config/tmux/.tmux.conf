# Bind config file
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Reloaded!"

# Bind prefix
unbind-key C-b
set -g prefix C-s
bind-key C-s send-prefix

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# kill pane
bind-key x kill-pane

# Chat window
bind-key v split-window -h -p 25

# Pane resizing
bind -n M-h resize-pane -L
bind -n M-l resize-pane -R
bind -n M-k resize-pane -U
bind -n M-j resize-pane -D

# Move window to the left
bind -n M-i swap-window -t -1

# Move window to the right
bind -n M-o swap-window -t +1

# Set vi mode
set-window-option -g mode-keys vi

# Use visual selection mode as vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Enable 24-bit color
set -g default-terminal "tmux-256color"
set -as terminal-overrides ',xterm-256color:RGB'

# Status bar config
# Nerdfont characters
HALF_ROUND_OPEN="#(printf '\uE0B6')"
HALF_ROUND_CLOSE="#(printf '\uE0B4')"
TRIANGLE_OPEN="#(printf '\uE0B2')"
TRIANGLE_CLOSE="#(printf '\uE0B0')"
BG="#292522"
STATUS_BG="#292522"
STATUS_FG="#453e39"
ACTIVE_FG="#ECE1D7"
ACTIVE_BG="#34302C"
INACTIVE_FG="#cfb39a"
INACTIVE_BG="#292522"
RIGHT_BG="#414559"
ACTIVE_FADED_FG="#c09c7b"
INACTIVE_FADED_FG="#c09c7b"
BORDER_ACTIVE="#1d1a18"
BORDER_INACTIVE="#1d1a18"

set -g status-position top
set-option -g status-style bg="${STATUS_BG}",fg="${STATUS_FG}"
set-option -g status-justify absolute-centre
set-option -g status-left "#[bg={ACTIVE_BG},fg={ACTIVE_FG}]${HALF_ROUND_OPEN} #[bg={STATUS_FG},fg={ACTIVE_BG}]#S #[bg={ACTIVE_BG},fg={ACTIVE_FG}]${HALF_ROUND_CLOSE}"
set-option -g status-right "#[bg=#{ACTIVE_BG},fg=#{ACTIVE_FG}]${HALF_ROUND_OPEN} #[bg={STATUS_FG},fg={ACTIVE_BG}]#h #[bg=#{RIGHT_BG},fg=#{RIGHT_FG}]${HALF_ROUND_CLOSE}"

# Window status format
set-option -g window-status-format "#[bg=#{INACTIVE_BG},fg=#{INACTIVE_FG}]${HALF_ROUND_OPEN}#[bg=#{INACTIVE_FG},fg=#{INACTIVE_BG}]#I:#W#[bg=#{INACTIVE_BG},fg=#{INACTIVE_FG}]${HALF_ROUND_CLOSE}"
set-option -g window-status-current-format "#[bg=#{ACTIVE_BG},fg=#{ACTIVE_FG}]${HALF_ROUND_OPEN}#[bg=#{ACTIVE_FG},fg=#{ACTIVE_BG}]#I:#W#[bg=#{ACTIVE_BG},fg=#{ACTIVE_FG}]${HALF_ROUND_CLOSE}"
set-option -g window-status-separator " "

# Opencode popup window
bind-key o run-shell 'cd "#{pane_current_path}" && ~/.tmux/opencode_popup.sh'

# Save and restore session
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'
set -g @continuum-restore 'on'

TMUX_FZF_ORDER="session|window|pane|command|keybinding"
TMUX_FZF_OPTIONS="-p -w 90% -h 70% -m"

# more options here: https://github.com/sainnhe/tmux-fzf/issues/6#issuecomment-578750879
bind w run-shell -b "~/.config/tmux/plugins/tmux-fzf/scripts/window.sh switch"

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @resurrect-strategy-nvim 'session'

# Always at the bottom, initialize tpm
run '~/.config/tmux/plugins/tpm/tpm'
